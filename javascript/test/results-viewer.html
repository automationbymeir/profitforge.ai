<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProfitForge.ai - Results Viewer</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        line-height: 1.6;
        max-width: 1400px;
        margin: 40px auto;
        padding: 20px;
        color: #333;
        background: #f5f5f5;
      }

      h1 {
        color: #0078d4;
        border-bottom: 2px solid #0078d4;
        padding-bottom: 10px;
        margin-bottom: 30px;
      }

      .subtitle {
        color: #666;
        font-size: 1.1em;
        margin-bottom: 30px;
      }

      .controls {
        background: #f9f9f9;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        display: flex;
        gap: 15px;
        align-items: flex-end;
        flex-wrap: wrap;
      }

      .form-group {
        flex: 1;
        min-width: 200px;
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: #333;
      }

      input,
      select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #0078d4;
      }

      button {
        background: #0078d4;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background 0.2s;
        white-space: nowrap;
      }

      button:hover {
        background: #005a9e;
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      .results-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 30px;
      }

      .card-header {
        background: #0078d4;
        color: white;
        padding: 20px 25px;
      }

      .card-header h2 {
        font-size: 1.5em;
        margin-bottom: 5px;
      }

      .card-meta {
        opacity: 0.9;
        font-size: 0.9em;
      }

      .card-body {
        padding: 25px;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
        padding-bottom: 25px;
        border-bottom: 2px solid #f0f0f0;
      }

      .info-item {
        display: flex;
        flex-direction: column;
      }

      .info-label {
        font-size: 0.85em;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 5px;
      }

      .info-value {
        font-size: 1.1em;
        font-weight: 600;
        color: #333;
      }

      .status {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 600;
      }

      .status.completed {
        background: #d4edda;
        color: #155724;
      }

      .status.failed {
        background: #f8d7da;
        color: #721c24;
      }

      .status.pending {
        background: #fff3cd;
        color: #856404;
      }

      .products-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      .products-table thead {
        background: #f8f9fa;
      }

      .products-table th {
        text-align: left;
        padding: 15px;
        font-weight: 600;
        color: #0078d4;
        text-transform: uppercase;
        font-size: 0.85em;
        letter-spacing: 0.5px;
        border-bottom: 2px solid #0078d4;
      }

      .products-table td {
        padding: 15px;
        border-bottom: 1px solid #e0e0e0;
      }

      .products-table tbody tr:hover {
        background: #f8f9ff;
      }

      .product-name {
        font-weight: 500;
        color: #333;
      }

      .product-sku {
        font-family: "Courier New", monospace;
        color: #666;
        font-size: 0.9em;
      }

      .product-price {
        font-weight: 600;
        color: #0078d4;
        font-size: 1.1em;
      }

      .product-unit {
        color: #666;
        font-size: 0.9em;
      }

      .loading {
        text-align: center;
        padding: 60px 20px;
        color: #666;
        font-size: 1.2em;
      }

      .loading:after {
        content: "...";
        animation: dots 1.5s steps(4, end) infinite;
      }

      @keyframes dots {
        0%,
        20% {
          content: ".";
        }
        40% {
          content: "..";
        }
        60%,
        100% {
          content: "...";
        }
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #721c24;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
      }

      .empty-state h3 {
        margin-bottom: 10px;
        color: #333;
      }

      .product-count {
        background: rgba(255, 255, 255, 0.3);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 600;
        margin-left: 10px;
      }
    </style>
  </head>
  <body>
    <div>
      <h1>ProfitForge.ai - Results Viewer</h1>
      <p class="subtitle">Product Catalog Extraction Results</p>

      <div class="controls">
        <div class="form-group">
          <label for="functionUrl">Function App URL</label>
          <input
            type="text"
            id="functionUrl"
            value="http://localhost:7071"
            placeholder="https://..."
          />
        </div>
        <div class="form-group">
          <label for="resultId">Result ID (optional)</label>
          <input type="text" id="resultId" placeholder="Enter UUID" />
        </div>
        <div class="form-group">
          <label for="vendor">Vendor Name (optional)</label>
          <input type="text" id="vendor" placeholder="e.g., Hatteras" />
        </div>
        <button onclick="loadResults()">Load Results</button>
      </div>

      <div id="content">
        <div class="empty-state">
          <h3>ðŸ‘† Enter parameters and click "Load Results"</h3>
          <p>View processed documents and extracted product catalogs</p>
        </div>
      </div>
    </div>

    <script>
      async function loadResults() {
        const content = document.getElementById("content");
        const baseUrl = document.getElementById("functionUrl").value.replace(/\/$/, "");
        const resultId = document.getElementById("resultId").value.trim();
        const vendor = document.getElementById("vendor").value.trim();

        let url = `${baseUrl}/api/getResults?limit=10`;
        if (resultId) url += `&resultId=${encodeURIComponent(resultId)}`;
        if (vendor) url += `&vendor=${encodeURIComponent(vendor)}`;

        content.innerHTML = '<div class="loading">Loading results</div>';

        try {
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const results = await response.json();

          if (results.length === 0) {
            content.innerHTML = `
              <div class="empty-state">
                <h3>No results found</h3>
                <p>Try adjusting your filters or upload a new document</p>
              </div>
            `;
            return;
          }

          content.innerHTML = results.map((result) => renderResultCard(result)).join("");
        } catch (error) {
          content.innerHTML = `
            <div class="error">
              <strong>Error loading results:</strong><br/>
              ${error.message}
            </div>
          `;
        }
      }

      function renderResultCard(result) {
        const analysis = result.ai_model_analysis;
        const products = analysis?.products || [];
        const vendor = analysis?.vendor || "Unknown";

        const statusClass = result.processing_status || "pending";

        return `
          <div class="results-card">
            <div class="card-header">
              <h2>${vendor} <span class="product-count">${products.length} products</span></h2>
              <div class="card-meta">
                ðŸ“„ ${result.document_path} â€¢ 
                ðŸ“… ${new Date(result.created_at).toLocaleString()}
              </div>
            </div>
            <div class="card-body">
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">Status</span>
                  <span class="info-value">
                    <span class="status ${statusClass}">${result.processing_status}</span>
                  </span>
                </div>
                <div class="info-item">
                  <span class="info-label">Result ID</span>
                  <span class="info-value" style="font-size: 0.85em;">${result.result_id}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Vendor</span>
                  <span class="info-value">${result.vendor_name || vendor}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Document Name</span>
                  <span class="info-value" style="font-size: 0.9em;">${result.document_name}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Pages / Tables</span>
                  <span class="info-value">${result.doc_intel_page_count} / ${result.doc_intel_table_count}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">AI Model</span>
                  <span class="info-value">${result.ai_model_used || "N/A"}</span>
                </div>
              </div>

              ${
                products.length > 0
                  ? `
                <h3>ðŸ“¦ Extracted Products</h3>
                <table class="products-table">
                  <thead>
                    <tr>
                      <th>SKU</th>
                      <th>Product Name</th>
                      <th>Price</th>
                      <th>Unit/Dimensions</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${products
                      .map(
                        (product) => `
                      <tr>
                        <td><span class="product-sku">${product.sku}</span></td>
                        <td><span class="product-name">${product.name}</span></td>
                        <td><span class="product-price">$${product.price.toFixed(2)}</span></td>
                        <td><span class="product-unit">${product.unit || "N/A"}</span></td>
                      </tr>
                    `
                      )
                      .join("")}
                  </tbody>
                </table>
              `
                  : `
                <div class="empty-state">
                  <h3>No products extracted</h3>
                  <p>${result.processing_status === "completed" ? "Document processed but no products found" : "Processing not yet complete"}</p>
                </div>
              `
              }
            </div>
          </div>
        `;
      }

      // Auto-load on page load if resultId in URL params
      window.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const resultId = params.get("resultId");
        const vendor = params.get("vendor");

        if (resultId) {
          document.getElementById("resultId").value = resultId;
        }
        if (vendor) {
          document.getElementById("vendor").value = vendor;
        }

        if (resultId || vendor) {
          loadResults();
        }
      });
    </script>
  </body>
</html>
